# Задача: Синхронизация каталога паттернов и матрицы покрытия R8

## 1. Контекст

В системе тестирования R8 используются несколько документов, описывающих fault-паттерны и их покрытие:

- `apps/otp/router/test/TRIPLE_FAULT_PATTERNS_CATALOG.md` — каталог паттернов
- `apps/otp/router/test/R8_COVERAGE_MATRIX.md` — матрица покрытия R8
- `apps/otp/router/test/R8_EXTENDED_COVERAGE.md` — расширенное покрытие смешанных паттернов
- `apps/otp/router/test/R8_SUMMARY.md` — сводка по покрытию/паттернам
- `apps/otp/router/test/R8_FINAL_SUMMARY.md` — финальная сводка покрытия

В этих документах ранее были несогласованности:

- Разные номера и порядок паттернов в каталоге и матрице
- Наличие `Pattern 2.3 (Cascading Fault Chains)` в матрице при отсутствии в каталоге
- Смешение порядков `Pattern 2.3` и `Pattern 2.4`
- Статусы покрытия могли не совпадать между документами

## 2. Цель задачи

Обеспечить **полную синхронизацию**:

- нумерации и порядка паттернов
- статусов покрытия (Covered / Future)
- ссылок между матрицей и каталогом

во всех документах, относящихся к R8-паттернам второго уровня (`Pattern 2.x`), с особым вниманием к:

- `Pattern 2.3: Cascading Fault Chains`
- `Pattern 2.4: Persistent NATS Latency + Intermittent Policy`

## 3. Выполненные шаги (логика задачи)

### 3.1. Проверка каталога и матрицы R8

**Проверено** содержимое `TRIPLE_FAULT_PATTERNS_CATALOG.md` и `R8_COVERAGE_MATRIX.md`.

**Выявлено**:

- В `R8_COVERAGE_MATRIX.md` есть `Pattern 2.3 (Cascading Fault Chains)`
- В каталоге этот паттерн отсутствовал
- Порядок и нумерация паттернов 2.3 / 2.4 не совпадали между документами

### 3.2. Синхронизация нумерации паттернов

**Добавлен** в каталог:

- `Pattern 2.3: Cascading Fault Chains` — с описанием и привязкой к существующим тестам

**Перенумерован**/перенесен:

- `Persistent NATS Latency` → `Pattern 2.4: Persistent NATS Latency + Intermittent Policy`

**Устранено несоответствие порядка**:

- В каталоге паттерны `2.3` и `2.4` были в обратном порядке
- Порядок приведен в соответствие с `R8_COVERAGE_MATRIX.md`

### 3.3. Обновление матрицы покрытия

В `R8_COVERAGE_MATRIX.md`:

- Зафиксирован `Pattern 2.3: Cascading Fault Chains` со статусом `✅ Covered`
- Зафиксирован `Pattern 2.4: Persistent NATS Latency + Intermittent Policy` со статусом `⏳ Future`
- Добавлены/уточнены ссылки на каталог паттернов

### 3.4. Обновление расширенных документов

В `R8_EXTENDED_COVERAGE.md`:

- Обновлен список Extended Mixed Patterns (4 паттерна) с учетом актуальных названий/номеров
- Исправлены ссылки на паттерны (Pattern 2.4 вместо Pattern 2.3 для Persistent NATS Latency)

В `R8_SUMMARY.md`:

- Обновлен список расширенных смешанных паттернов, чтобы он соответствовал каталогу и матрице
- Исправлен порядок паттернов 2.3 и 2.4

В `R8_FINAL_SUMMARY.md`:

- Исправлен порядок паттернов 2.3 и 2.4 в таблице покрытия

### 3.5. Финальная валидация

Повторная проверка каталога и матрицы:

- Убедился, что `Pattern 2.3` и `Pattern 2.4` присутствуют в каталоге
- Убедился, что порядок паттернов 2.3 и 2.4一致ен во всех документах
- Обновлена внутренняя матрица покрытия внутри каталога, чтобы отражать актуальный порядок и статусы

## 4. Результат (инварианты после задачи)

### 4.1. Pattern 2.3: Cascading Fault Chains

- **Каталог**: `TRIPLE_FAULT_PATTERNS_CATALOG.md` — есть описание паттерна и тестов
- **Матрица**: `R8_COVERAGE_MATRIX.md` — статус `✅ Covered`
- **Статус**: **покрыт тестами**

### 4.2. Pattern 2.4: Persistent NATS Latency + Intermittent Policy

- **Каталог**: `TRIPLE_FAULT_PATTERNS_CATALOG.md` — есть описание паттерна, помечен как `⏳ Future`
- **Матрица**: `R8_COVERAGE_MATRIX.md` — статус `⏳ Future`
- **Статус**: **запланированное улучшение (не реализован, не покрыт тестами)**

### 4.3. Обновленные файлы

- ✅ `apps/otp/router/test/TRIPLE_FAULT_PATTERNS_CATALOG.md`
- ✅ `apps/otp/router/test/R8_COVERAGE_MATRIX.md`
- ✅ `apps/otp/router/test/R8_EXTENDED_COVERAGE.md`
- ✅ `apps/otp/router/test/R8_SUMMARY.md`
- ✅ `apps/otp/router/test/R8_FINAL_SUMMARY.md`

## 5. Критерии приемки (для фиксации задачи как завершённой)

### 5.1. Нумерация и порядок

- ✅ Во всех документах `Pattern 2.3` — это `Cascading Fault Chains`, а `Pattern 2.4` — `Persistent NATS Latency + Intermittent Policy`
- ✅ Порядок паттернов 2.3 и 2.4 одинаков во всех файлах

### 5.2. Статусы

- ✅ `Pattern 2.3` везде помечен как покрытый тестами (`✅ Covered`)
- ✅ `Pattern 2.4` везде помечен как `⏳ Future`

### 5.3. Ссылки и матрицы

- ✅ Все матрицы покрытия (в каталоге и в `R8_COVERAGE_MATRIX.md`) согласованы:
  - одни и те же паттерны
  - одинаковые названия
  - одинаковые статусы

## 6. Статус задачи

**Статус**: ✅ **Завершена**

**Дата завершения**: 2025-11-30

**Проверка**:
- ✅ Все документы синхронизированы
- ✅ Нумерация паттернов согласована
- ✅ Статусы покрытия совпадают
- ✅ Ссылки между документами корректны

## 7. Примечания

- Документ `PATTERN_2_3_IMPLEMENTATION_TASK.md` содержит устаревшую информацию о нумерации паттернов (создан до синхронизации) и может быть обновлен отдельно при необходимости
- Все основные документы R8 (каталог, матрица, расширенное покрытие, сводки) теперь полностью синхронизированы

## 8. Область охвата синхронизации

В рамках данной задачи синхронизируются только документы, описывающие **каталог паттернов и их покрытие** для R8:

- `TRIPLE_FAULT_PATTERNS_CATALOG.md`
- `R8_COVERAGE_MATRIX.md`
- `R8_EXTENDED_COVERAGE.md`
- `R8_SUMMARY.md`
- `R8_FINAL_SUMMARY.md`
- `JETSTREAM_FAULT_INJECTION_TESTS.md` (разделы, ссылающиеся на паттерны 2.x)

Вне области текущей задачи (отдельные задачи при изменении статуса Pattern 2.4 или добавлении новых паттернов):

- task-документы реализации (`PATTERN_2_3_IMPLEMENTATION_TASK.md`, `PATTERN_2_4_IMPLEMENTATION_TASK.md` и др.)
- usage-guides и how-to документы
- общие требования и трассируемость (`FAULT_INJECTION_REQUIREMENTS_TRACEABILITY.md`, R8-разделы)

При изменении статуса `Pattern 2.4` (с `⏳ Future` на `✅ Covered`) должна быть заведена **отдельная задача**, которая:

- обновит статусы и ссылки во всех перечисленных выше документах
- пересмотрит разделы в `PATTERN_2_4_IMPLEMENTATION_TASK.md`

## 9. Регламент проверок на будущее

Рекомендуется повторять проверку синхронизации паттернов R8 в следующих случаях:

- перед закрытием R8 или релизом, затрагивающим fault-injection
- при добавлении новых паттернов `Pattern 2.x` или изменении их статуса
- при изменении тестовых suites, указанных в каталоге/матрице
- при создании новых task-документов для паттернов уровня 2.x

Минимальный набор действий при ревью:

- сравнить список паттернов 2.x в `TRIPLE_FAULT_PATTERNS_CATALOG.md` и `R8_COVERAGE_MATRIX.md`
- проверить статусы `Pattern 2.3` и `Pattern 2.4` во всех R8-дашбордах/сводках
- убедиться, что ссылки из матрицы ведут на корректные якоря в каталоге

## 10. Чеклист ручной валидации

При точечной проверке синхронизации удобно использовать следующий чеклист:

- **[ ] Нумерация**: во всех документах `Pattern 2.3` — это `Cascading Fault Chains`, `Pattern 2.4` — `Persistent NATS Latency + Intermittent Policy`
- **[ ] Статусы**: во всех документах `Pattern 2.3` = `✅ Covered`, `Pattern 2.4` = `⏳ Future`
- **[ ] Ссылки**: все ссылки вида `#pattern-23-*` и `#pattern-24-*` ведут на корректные заголовки в каталоге
- **[ ] Матрицы**: таблицы в `R8_COVERAGE_MATRIX.md`, `TRIPLE_FAULT_PATTERNS_CATALOG.md` и `R8_FINAL_SUMMARY.md` содержат одинаковый набор паттернов 2.x
- **[ ] Документы задач**: task-документы явно указывают, к какому ID паттерна (2.3 или 2.4) они относятся, и не противоречат каталогу/матрице

Если любой пункт чеклиста не выполняется, необходимо либо повторно запустить данную задачу синхронизации, либо создать новую точечную задачу на корректировку конкретного документа.
